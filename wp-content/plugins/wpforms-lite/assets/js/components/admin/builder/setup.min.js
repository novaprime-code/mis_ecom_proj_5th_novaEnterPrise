"use strict";var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.Setup=WPForms.Admin.Builder.Setup||function(a,s){var n={},l={};const o=s(".wpforms-template.selected .wpforms-template-name").text().trim();var i={init:function(){s(i.ready),s(a).on("load",function(){"function"==typeof s.ready.then?s.ready.then(i.load):i.load()})},ready:function(){i.setup(),i.setPanelsToggleState(),i.setupTitleFocus(),i.setTriggerBlankLink(),i.events(),n.$builder.trigger("wpformsBuilderSetupReady")},load:function(){i.applyTemplateOnRequest()},setup:function(){n={$builder:s("#wpforms-builder"),$form:s("#wpforms-builder-form"),$formName:s("#wpforms-setup-name"),$panel:s("#wpforms-panel-setup"),$categories:s("#wpforms-panel-setup .wpforms-setup-templates-categories")},l.templateList=new List("wpforms-setup-templates-list",{valueNames:["wpforms-template-name","wpforms-template-desc",{name:"categories",attr:"data-categories"}]}),l.spinner='<i class="wpforms-loading-spinner wpforms-loading-white wpforms-loading-inline"></i>',l.formID=n.$form.data("id")},events:function(){n.$panel.on("keyup","#wpforms-setup-template-search",WPFormsFormTemplates.searchTemplate).on("click",".wpforms-setup-templates-categories li",WPFormsFormTemplates.selectCategory).on("click",".wpforms-template-select",i.selectTemplate).on("click",".wpforms-trigger-blank",i.selectBlankTemplate),n.$builder.on("wpformsPanelSwitched",i.setupTitleFocus),n.$builder.on("input","#wpforms-panel-field-settings-form_title",i.syncTitle).on("input","#wpforms-setup-name",i.syncTitle)},setPanelsToggleState:function(){n.$builder.find("#wpforms-panels-toggle button:not(.active)").toggleClass("wpforms-disabled",""===l.formID)},setTriggerBlankLink:function(){n.$builder.find(".wpforms-trigger-blank").attr({"data-template-name-raw":"Blank Form","data-template":"blank"})},setupTitleFocus:function(e,t){"setup"===(t=void 0===t?wpf.getQueryString("view"):t)&&n.$formName.trigger("focus")},syncTitle:function(e){("wpforms-setup-name"===e.target.id?s("#wpforms-panel-field-settings-form_title"):s("#wpforms-setup-name")).val(e.target.value)},searchTemplate:function(e){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.searchTemplate( e )" has been deprecated, please use the new "WPFormsFormTemplates.searchTemplate( e )" function instead!'),WPFormsFormTemplates.searchTemplate(e)},selectCategory:function(e){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.selectCategory( e )" has been deprecated, please use the new "WPFormsFormTemplates.selectCategory( e )" function instead!'),WPFormsFormTemplates.selectCategory(e)},selectTemplate:function(e){e.preventDefault();var e=s(this),t=e.data("template"),a=i.getFormName(e);e.hasClass("education-modal")||(n.$panel.find(".wpforms-template").removeClass("active"),e.closest(".wpforms-template").addClass("active"),e.data("labelOriginal",e.html()),e.html(l.spinner+wpforms_builder.loading),i.applyTemplate(a,t,e))},getFormName:function(e){var e=e.data("template-name-raw"),t=n.$formName.val();return!t||o===t?e:t},applyTemplate:function(e,t,a){n.$builder.trigger("wpformsTemplateSelect",t),l.formID?i.selectTemplateExistingForm(e,t,a):i.selectTemplateProcess(e,t,a)},selectBlankTemplate:function(e){e.preventDefault();var e=s(e.target),t=n.$formName.val()||wpforms_builder.blank_form;i.applyTemplate(t,"blank",e)},selectTemplateExistingForm:function(e,t,a){s.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.template_confirm,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){i.selectTemplateProcess(e,t,a)}},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},selectTemplateProcess:function(e,t,a){a.data("addons")?i.addonsModal(e,t,a):i.selectTemplateProcessAjax(e,t)},selectTemplateCancel:function(){console.warn('WARNING! Function "WPForms.Admin.Builder.Setup.selectTemplateCancel" has been deprecated, please use the new "WPFormsFormTemplates.selectTemplateCancel" function instead!'),WPFormsFormTemplates.selectTemplateCancel()},selectTemplateProcessAjax:function(t,e){WPFormsBuilder.showLoadingOverlay();e={title:t,action:l.formID?"wpforms_update_form_template":"wpforms_new_form",template:e,form_id:l.formID,nonce:wpforms_builder.nonce};s.post(wpforms_builder.ajax_url,e).done(function(e){e.success?(WPFormsBuilder.setCloseConfirmation(!1),a.location.href=wpf.getQueryString("force_desktop_view")?wpf.updateQueryString("force_desktop_view",1,e.data.redirect):e.data.redirect):(wpf.debug(e),"invalid_template"===e.data.error_type?i.selectTemplateProcessInvalidTemplateError(e.data.message,t):i.selectTemplateProcessError(e.data.message))}).fail(function(e,t,a){wpf.debug(e.responseText||t||""),i.selectTemplateProcessError("")})},selectTemplateProcessInvalidTemplateError:function(e,t){s.alert({title:wpforms_builder.heads_up,content:e,icon:"fa fa-exclamation-circle",type:"orange",boxWidth:"600px",buttons:{confirm:{text:wpforms_builder.use_simple_contact_form,btnClass:"btn-confirm",keys:["enter"],action:function(){i.selectTemplateProcessAjax(t,"simple-contact-form-template"),WPFormsBuilder.hideLoadingOverlay()}},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel(),WPFormsBuilder.hideLoadingOverlay()}}}})},selectTemplateProcessError:function(e){e=e&&e.length?"<p>"+e+"</p>":"";s.alert({title:wpforms_builder.heads_up,content:wpforms_builder.error_select_template+e,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){WPFormsFormTemplates.selectTemplateCancel(),WPFormsBuilder.hideLoadingOverlay()}}}})},addonsModal:function(e,t,a){var n=a.data("template-name-raw"),o=a.data("addons-names"),r=a.data("addons").split(","),a=1<r.length?wpforms_builder.template_addons_prompt:wpforms_builder.template_addon_prompt;r.length&&s.confirm({title:wpforms_builder.heads_up,content:a.replace(/%template%/g,n).replace(/%addons%/g,o),icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_education.install_confirm,btnClass:"btn-confirm",keys:["enter"],action:function(){return this.$$confirm.prop("disabled",!0).html(l.spinner+wpforms_education.activating),this.$$cancel.prop("disabled",!0),i.installActivateAddons(r,this,e,t),!1}},cancel:{text:wpforms_education.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},installActivateAddons:function(e,t,a,n){var o=[],r=[],s=!1;e.forEach(function(t){s="function"!=typeof s.done?i.installActivateAddonAjax(t):s.done(function(e){return o.push(e),i.installActivateAddonAjax(t)}).fail(function(e){r.push(e)})}),s.done(function(e){o.push(e)}).fail(function(e){r.push(e)}).always(function(){t.close(),0<o.length&&wpf.listPluck(o,"success").every(Boolean)&&0===r.length?i.selectTemplateProcessAjax(a,n):i.installActivateAddonsError(a,n)})},installActivateAddonsError:function(e,t){s.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.template_addons_error,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.use_template,btnClass:"btn-confirm",keys:["enter"],action:function(){i.selectTemplateProcessAjax(e,t)}},cancel:{text:wpforms_builder.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},installActivateAddonAjax:function(e){var t=wpforms_addons[e],a=new s.Deferred;return!t||["activate","install"].indexOf(t.action)<0?(a.resolve(!1),a.promise()):s.post(wpforms_education.ajax_url,{action:"wpforms_"+t.action+"_addon",nonce:wpforms_builder.admin_nonce,plugin:"activate"===t.action?e+"/"+e+".php":t.url})},applyTemplateOnRequest:function(){var e=new URLSearchParams(a.location.search),t=e.get("template_id");"setup"===e.get("view")&&!e.get("form_id")&&t&&n.$panel.find('.wpforms-template .wpforms-btn[data-template="'+t+'"]').trigger("click")}};return i}((document,window),jQuery),WPForms.Admin.Builder.Setup.init();