!function(n){function e(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return n[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t={};e.m=n,e.c=t,e.d=function(n,t,i){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:i})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(i,o,function(e){return n[e]}.bind(null,o));return i},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=228)}({209:function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMonsterlink=function(n){return OMAPI.monsterlink+n+"/"}},228:function(n,e,t){"use strict";var i=t(209);window.OMAPI_Editor=window.OMAPI_Editor||{},function(n,e,t,o){n.OMAPI=n.OMAPI||{},OMAPI.monsterlink=o.monsterlink,o.getActiveEditorId=function(){var e=n.wpActiveEditor,t=n.tinymce;return wp.media.editor.activeEditor&&(e=wp.media.editor.activeEditor),!e&&t&&t.activeEditor&&(e=t.activeEditor.id),e},o.getActiveEditor=function(){var e=o.getActiveEditorId();return e&&n.tinymce?n.tinymce.get(e):null},o.mceLinkifyText=function(){var n=o.$select.val();n&&o.getActiveEditor().execCommand("mceInsertLink",!1,{href:(0,i.getMonsterlink)(n),target:"_blank",rel:"noopener noreferrer"})},o.modalOpenLink=function(){o.$toToggle.addClass("optin-monster-modal-monsterlink").removeClass("optin-monster-modal-inline"),o.$body.addClass("modal-open om-modal-open-monsterlink"),o.$modalWrap.show(),o.updateLinkSelectOptions(o.$select),t(".wp-link-input").parent().find(".dashicons-admin-generic").parent().click(),t(e).trigger("om-modal-open-monsterlink")},o.modalOpenInline=function(){o.$toToggle.addClass("optin-monster-modal-inline").removeClass("optin-monster-modal-monsterlink").show(),o.$body.addClass("modal-open om-modal-open-inline"),o.updateInlineSelectOptions(),t(e).trigger("om-modal-open-inline")},o.modalClose=function(){["$select","$linkSelect","$inlineSelect"].forEach((function(n){o[n]&&o[n].length&&o[n].val("")})),o.$toToggle.hide();var n=o.$body.hasClass("om-modal-open-monsterlink")?"monsterlink":"inline";o.$body.removeClass("modal-open om-modal-open-monsterlink om-modal-open-inline"),t(e).trigger("om-modal-close-"+n)},o.insertShortcode=function(){var n=o.$inlineSelect.val();n&&wp.media.editor.insert('[optin-monster slug="'+n+'" followrules="true"]')},o.updateLinkSelectOptions=function(n){var e=t("#wp-link-wrap #link-selector"),o=e.find("#search-panel"),l=o.offset().top+o.outerHeight()-e.offset().top+12;t(".has-text-field #wp-link .query-results").css({top:l});var r=t(".wp-link-input input.ui-autocomplete-input").val();r&&n.find("option").each((function(){var e=t(this).val();e&&r===(0,i.getMonsterlink)(e)&&n.val(e)}))},o.updateInlineSelectOptions=function(){var n=o.getActiveEditorId();if(n){var i=o.getActiveEditor(),l=i&&!i.isHidden()?i.getContent():e.getElementById(n).value;o.$inlineSelect.find("option").each((function(){var n=t(this),e=0<=l.indexOf('optin-monster slug="'+n.val()+'"');n.attr("disabled",e)}))}},o.initLinkButton=function(){t(".wp-link-input").each((function(){var n=t(this).parent();if(!n.find(".optin-monster-insert-monsterlink").length){var e=t('<div class="mce-widget mce-btn mce-last" tabindex="-1" role="button" aria-label="OptinMonster" style="margin-left:-3px;"></div>'),i=t('<button role="presentation" type="button" tabindex="-1" class="optin-monster-insert-monsterlink"></button>');i.append(t(".wp-media-buttons-icon.optin-monster-menu-icon").first().clone()),e.append(i),n.find(".mce-last").removeClass("mce-last"),n.append(e)}}))},o.initAdvancedSettings=function(){var e=t('\n\t\t\t<p class="howto" id="om-link-campaign-label">'+o.i18n.or_monsterlink+'</p>\n\t\t\t<div style="margin-bottom: -8px;">\n\t\t\t\t'+(o.canMonsterlink?'<label><span>Select</span>\n\t\t\t\t\t\t<select name="om-link-class" id="om-link-campaign" aria-describedby="om-link-campaign-label">\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</label>':'<p class="om-monsterlink-upgrade"><span>'+o.i18n.upgrade_monsterlink+'</span> <a href="'+o.upgradeUri.replace("--FEATURE--","monster-link")+'" target="_blank" rel="noopener">'+o.i18n.upgrade+"</a></p>")+"\n\t\t\t</div>\n\t\t");if(e.find("select").html(o.$select.find("option").clone()),e.find(".om-monsterlink-upgrade").length){var l=t("#om-monsterlink-upgrade").clone();e.find(".om-monsterlink-upgrade span").html(l.html())}if(t("#link-options").append(e),o.$linkSelect=t("#om-link-campaign"),void 0!==n.wpLink){var r=wpLink.getAttrs;wpLink.getAttrs=function(){var n=r(),e=(0,i.getMonsterlink)(o.$linkSelect.val());return n.href===e&&(n.target="_blank",n.rel="noopener noreferrer"),n}}},o.initEditorMods=function(n){!n||n.hasInitiatedOm||(n.hasInitiatedOm=!0,n.on("ExecCommand",(function(n){"WP_Link"===n.command&&o.initLinkButton()})),!o.$linkSelect&&o.initAdvancedSettings())},o.setupListeners=function(){t(e).on("click",".optin-monster-insert-campaign-button",(function(n){n.preventDefault(),o.modalOpenInline()})).on("click",".optin-monster-insert-monsterlink",(function(n){n.preventDefault(),o.modalOpenLink()})).on("click","#optin-monster-modal-backdrop, #optin-monster-modal-close, #optin-monster-modal-cancel a",(function(n){n.preventDefault(),o.modalClose()})).on("click","#optin-monster-modal-submit-inline",(function(n){n.preventDefault(),o.insertShortcode(),o.modalClose()})).on("click","#optin-monster-modal-submit",(function(n){n.preventDefault(),o.mceLinkifyText(),o.modalClose()})).on("change","#om-link-campaign",(function(){var n=o.$linkSelect.val();n&&(t("#wp-link-url").val((0,i.getMonsterlink)(n)),t("#wp-link-target").prop("checked",!0))})).on("wplink-open",(function(){o.updateLinkSelectOptions(o.$linkSelect)})).on("wplink-close",(function(){o.modalClose()})).on("om-modal-close-monsterlink",(function(){if(wpLink){var n=o.getActiveEditor();n&&!n.isHidden()&&wpLink.close()}}))},o.init=function(){o.$body=t(e.body),o.$modalWrap=t("#optin-monster-modal-wrap"),o.$toToggle=t("#optin-monster-modal-backdrop, #optin-monster-modal-wrap"),o.$select=t("#optin-monster-modal-select-campaign"),o.$inlineSelect=t("#optin-monster-modal-select-inline-campaign"),o.$linkSelect=null,o.setupListeners(),o.initEditorMods(o.getActiveEditor()),"undefined"!=typeof tinymce&&tinymce.on("SetupEditor",(function(n){var e=n.editor;o.initEditorMods(e)}))},t(o.init)}(window,document,jQuery,window.OMAPI_Editor)}});